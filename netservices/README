ğŸ“˜ Servidor Web - Proyecto Netservices

ğŸ§© DescripciÃ³n general
Netservices es un sistema web basado en PHP que gestiona accesos diferenciados por rol:

-   ğŸ” Administradores acceden a paneles de gestiÃ³n.
-   ğŸ‘¤ Usuarios normales visualizan su contenido personalizado.

ğŸ“ Estructura del Proyecto
.
â”œâ”€â”€ admin
â”‚ â”œâ”€â”€ admin.php
â”‚ â””â”€â”€ editar_formulario.php
â”œâ”€â”€ config
â”‚ â””â”€â”€ routes.php
â”œâ”€â”€ controllers
â”‚ â”œâ”€â”€ admin
â”‚ â”‚ â””â”€â”€ require_admin.php
â”‚ â”œâ”€â”€ usuario
â”‚ â”‚ â”œâ”€â”€ cambiar_password.php
â”‚ â”‚ â”œâ”€â”€ editar_usuario.php
â”‚ â”‚ â”œâ”€â”€ eliminar_usuario.php
â”‚ â”‚ â””â”€â”€ require_usuario.php
â”‚ â”œâ”€â”€ login.php
â”‚ â”œâ”€â”€ logout.php
â”‚ â””â”€â”€ registrar.php
â”œâ”€â”€ db
â”‚ â””â”€â”€ netservices.sql
â”œâ”€â”€ public
â”‚ â”œâ”€â”€ assets
â”‚ â”‚ â”œâ”€â”€ css
â”‚ â”‚ â”‚ â”œâ”€â”€ stilo-admin.css
â”‚ â”‚ â”‚ â””â”€â”€ stilo-general.css
â”‚ â”‚ â””â”€â”€ img
â”‚ â”‚ â””â”€â”€ logo.png
â”‚ â”œâ”€â”€ .htaccess
â”‚ â””â”€â”€ index.php
â”œâ”€â”€ views
â”‚ â”œâ”€â”€ admin
â”‚ â”‚ â””â”€â”€ gestionar_usuarios.php
â”‚ â”œâ”€â”€ usuario
â”‚ â”‚ â”œâ”€â”€ panel_usuario.php
â”‚ â”‚ â””â”€â”€ perfil.php
â”‚ â”œâ”€â”€ acceso_denegado.php
â”‚ â”œâ”€â”€ login.php
â”‚ â””â”€â”€ registro.php
â”œâ”€â”€ .dockerignore
â”œâ”€â”€ .env.example
â”œâ”€â”€ .gitignore
â”œâ”€â”€ composer.json
â”œâ”€â”€ composer.lock
â”œâ”€â”€ docker-compose.prod.yml
â”œâ”€â”€ docker-compose.yml
â”œâ”€â”€ Dockerfile
â”œâ”€â”€ header.php
â”œâ”€â”€ installDocker.txt
â””â”€â”€ README

ğŸ” Arquitectura y Flujo de la AplicaciÃ³n

-   **Punto de Entrada Ãšnico (Front Controller):** Todas las peticiones son dirigidas a `public/index.php`. Esto mejora la seguridad y centraliza el control. El archivo `.htaccess` dentro de `public/` se encarga de reescribir las URLs para que apunten a `index.php`.

-   **Enrutamiento:** El archivo `config/routes.php` define las rutas vÃ¡lidas de la aplicaciÃ³n y las asocia a los controladores correspondientes.

-   **Controladores:** La lÃ³gica de la aplicaciÃ³n (consultas a la base de datos, validaciones, etc.) reside en los archivos dentro de `controllers/`.

-   **Vistas:** Los controladores cargan las plantillas HTML/PHP desde el directorio `views/` para renderizar la respuesta que se envÃ­a al usuario.

-   **GestiÃ³n de Accesos:** Las sesiones se gestionan para diferenciar entre roles (`admin`, `usuario`). Los controladores `require_admin.php` y `require_usuario.php` protegen las rutas restringidas.
-   Seguridad reforzada con:
-   /controllers/admin/require_admin.php
-   /controllers/usuario/require_usuario.php
-   Reestablecimiento de contraseÃ±a y ediciÃ³n de perfil en /controllers/usuario/cambiar_password.php.

ğŸš€ NavegaciÃ³n dinÃ¡mica
El archivo header.php muestra enlaces personalizados segÃºn el tipo de sesiÃ³n activa.
Las rutas se construyen con la constante BASE_URL definida en /config/routes.php.

ğŸ§© Requisitos

-   Servidor Apache (ej. XAMPP, AlmaLinux + Apache)
-   PHP â‰¥ 8.0
-   Base de datos MySQL/MariaDB
-   Extensiones recomendadas:
-   mysqli
-   mbstring
-   json

# ğŸ§  Panel Admin en PHP puro

Este proyecto incluye un sistema de autenticaciÃ³n y panel administrativo usando PHP nativo + conexiÃ³n segura a MySQL mediante archivo `.env`.

## ğŸš€ InstalaciÃ³n con Docker (MÃ©todo Recomendado)

La forma mÃ¡s sencilla de ejecutar este proyecto es utilizando Docker y Docker Compose. Esto levantarÃ¡ tanto el servidor web como la base de datos de forma automÃ¡tica.

**Requisitos:**

-   [Docker](https://docs.docker.com/get-docker/)
-   [Docker Compose](https://docs.docker.com/compose/install/)

<details>
<summary>GuÃ­a de InstalaciÃ³n Manual de Docker en RHEL/CentOS</summary>

Esta es una guÃ­a detallada para instalar Docker manualmente si no puedes usar los repositorios oficiales.

1.  **Descargar Docker:**
    ```bash
    curl -o docker-latest.tgz https://download.docker.com/linux/static/stable/x86_64/docker-latest.tgz
    ```
2.  **Descomprimir:**
    ```bash
    tar xzvf docker-latest.tgz
    ```
3.  **Copiar binarios:**
    ```bash
    sudo cp docker/* /usr/bin/
    ```
4.  **Iniciar el servicio Docker (daemon):**
    ```bash
    sudo nohup dockerd > /var/log/docker.log 2>&1 &
    ```
5.  **Configurar para ejecutar sin `sudo` (Recomendado):**
    ```bash
    sudo groupadd docker
    sudo usermod -aG docker $USER
    # NecesitarÃ¡s cerrar sesiÃ³n y volver a entrar para que el cambio de grupo surta efecto.
    ```
6.  **Verificar instalaciÃ³n:**
    ```bash
    docker version
    docker run hello-world
    ```

</details>

**Pasos:**

1.  **Clona el repositorio:**

    ```bash
    git clone https://github.com/dakardu/netservices.git
    cd netservices
    ```

2.  **Crea el archivo de entorno:**
    Copia el archivo de ejemplo `.env.example` para crear tu propio archivo de configuraciÃ³n `.env`. Este archivo es fundamental, ya que contiene las credenciales para la base de datos.

    ```bash
    cp .env.example .env
    ```

    _Puedes modificar las credenciales dentro de `.env` si lo deseas, pero el proyecto funcionarÃ¡ con las que vienen por defecto para un entorno de desarrollo._

    > **Nota importante:** Las credenciales de la base de datos no estÃ¡n dentro de la imagen de Docker. TÃº las **defines** en este paso al crear el archivo `.env`. Docker Compose se encarga de usar estas credenciales para inicializar la base de datos y configurar la aplicaciÃ³n para que se conecte a ella.

3.  **Levanta los servicios con Docker Compose:**
    Este comando construirÃ¡ la imagen de la aplicaciÃ³n (si no existe localmente), descargarÃ¡ la imagen de MySQL y crearÃ¡ e iniciarÃ¡ los contenedores.

    ```bash
    docker-compose up -d --build
    ```

4.  **Accede a la aplicaciÃ³n:**
    Una vez que los contenedores estÃ©n en ejecuciÃ³n, abre tu navegador y visita:
    [http://localhost](http://localhost)

    TambiÃ©n puedes acceder a la base de datos a travÃ©s de phpMyAdmin en:
    [http://localhost:8080](http://localhost:8080)

---

## ğŸ­ Entornos de Desarrollo vs. ProducciÃ³n

Este proyecto incluye dos archivos de Docker Compose para gestionar diferentes entornos:

-   **`docker-compose.yml` (Desarrollo):**

    -   Expone el puerto de la base de datos (`3306`) para que puedas conectarte con un cliente de base de datos externo.
    -   Incluye `phpMyAdmin` en el puerto `8080` para una gestiÃ³n fÃ¡cil de la base de datos.
    -   Ideal para desarrollar y depurar.

-   **`docker-compose.prod.yml` (ProducciÃ³n):**
    -   **No expone** el puerto de la base de datos al exterior por seguridad. La base de datos solo es accesible por la aplicaciÃ³n.
    -   **No incluye** `phpMyAdmin`.
    -   Para usarlo, ejecuta: `docker-compose -f docker-compose.prod.yml up -d --build`

---
## ğŸš¢ Despliegue en Servidor (desde Docker Hub)

Este es el mÃ©todo recomendado para desplegar la aplicaciÃ³n en un servidor de producciÃ³n (ej. Ubuntu, RHEL, etc.), ya que no requiere clonar el cÃ³digo fuente.

1.  **Instala Docker y Docker Compose** en el servidor.

2.  **Crea una carpeta para el proyecto:**
    ```bash
    mkdir netservices-deploy
    cd netservices-deploy
    ```

3.  **Crea los archivos de configuraciÃ³n:**
    NecesitarÃ¡s tres elementos en esta carpeta:
    -   `docker-compose.prod.yml`: El archivo de orquestaciÃ³n.
    -   `.env`: El archivo con tus credenciales secretas.
    -   `db/netservices.sql`: El script para inicializar la base de datos.

    Puedes descargar el `docker-compose.prod.yml` y el `netservices.sql` directamente desde GitHub:
    ```bash
    # Descargar docker-compose para producciÃ³n
    curl -o docker-compose.prod.yml https://raw.githubusercontent.com/dakardu/netservices/main/docker-compose.prod.yml

    # Descargar script de la base de datos
    mkdir -p db
    curl -o db/netservices.sql https://raw.githubusercontent.com/dakardu/netservices/main/db/netservices.sql
    ```

4.  **Crea tu archivo `.env`** con las credenciales para producciÃ³n. Por ejemplo:
    ```ini
    DB_HOST=db
    DB_NAME=netservices_prod
    DB_USER=user_prod
    DB_PASSWORD=una_contraseÃ±a_muy_segura
    MYSQL_ROOT_PASSWORD=otra_contraseÃ±a_muy_segura
    ```
    > **Credenciales de acceso por defecto:** El script `netservices.sql` crea un usuario administrador inicial con `user: admin@dominio.com` y `password: admin`. Â¡Recuerda cambiar esta contraseÃ±a despuÃ©s del primer inicio de sesiÃ³n!

5.  **Levanta la aplicaciÃ³n:**
    Usa los siguientes comandos para descargar las imÃ¡genes de Docker Hub, limpiar restos de contenedores anteriores (opcional pero recomendado) e iniciar la aplicaciÃ³n.
    ```bash
    # Descargar las imÃ¡genes mÃ¡s recientes
    docker-compose -f docker-compose.prod.yml pull

    # (Opcional) Limpiar contenedores y volÃºmenes previos
    docker-compose -f docker-compose.prod.yml down -v

    # Iniciar la aplicaciÃ³n en segundo plano
    docker-compose -f docker-compose.prod.yml up -d
    ```
    Tu aplicaciÃ³n ahora estarÃ¡ funcionando en el puerto 80 del servidor.

## ğŸ”§ InstalaciÃ³n Manual (Alternativa)

Si prefieres no usar Docker, puedes instalar el proyecto manualmente en un servidor web local como XAMPP o similar.

1.  **Clona el repositorio.**
2.  **Configura el archivo `.env`** con las credenciales de tu base de datos local.
3.  **Importa la base de datos:** El archivo `db/netservices.sql` contiene la estructura y datos iniciales. ImpÃ³rtalo en tu gestor de MySQL o MariaDB.
4.  **Instala las dependencias** con Composer:
    ```bash
    composer install
    ```
5.  **Configura tu Servidor Web:**
    Apunta la raÃ­z de tu servidor web (DocumentRoot en Apache) al directorio `public/` del proyecto. **Esto es muy importante.** Todas las peticiones deben pasar por `public/index.php`.

ğŸ”’ Consideraciones para entornos con SELinux (Avanzado)
En sistemas Linux donde SELinux estÃ¡ activado en modo `enforcing`, es posible que necesites permitir que el contenedor de Apache se conecte a la red para acceder a la base de datos.

Ejecuta el siguiente comando en el **host** (no dentro del contenedor):

```bash
sudo setsebool -P httpd_can_network_connect_db 1
```

Esto mantiene el sistema seguro sin desactivar SELinux por completo.
